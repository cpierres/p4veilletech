<div class="chat-container">
  <div class="chat-header">
    <h2>Chatbot CV â€” RAG</h2>
    <mat-form-field appearance="outline" class="lang-select">
      <mat-label>Langue / Language</mat-label>
      <mat-select [value]="lang()" (valueChange)="lang.set($event)">
        <mat-option value="fr">FranÃ§ais</mat-option>
        <mat-option value="en">English</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="messages" #messagesContainer>
    <div *ngFor="let m of messages(); let i = index" [class.user]="m.role==='user'" [class.assistant]="m.role==='assistant'" class="message">
      <div class="bubble">
        <div [innerHTML]="renderMarkdown(m.text)"></div>
        <button *ngIf="m.role==='assistant' && m.text && m.text.trim()" type="button" (click)="playMessageTts(i)" style="margin-left:8px;" mat-stroked-button>
          ðŸ”Š
        </button>
      </div>
    </div>
  </div>

  <div style="display:flex; align-items:center; gap:12px; margin-top:8px;">
    <label style="font-size: 13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
      <input type="checkbox" [checked]="ttsEnabled()" (change)="onTtsToggle($event)" />
      {{ lang()==='fr' ? 'Lire la rÃ©ponse (TTS)' : 'Read the answer (TTS)' }}
    </label>
  </div>

  <form (ngSubmit)="send()" class="input-row">
    <mat-form-field class="input-field" appearance="outline">
      <mat-label>{{ lang()==='fr' ? 'Votre message' : 'Your message' }}</mat-label>
      <input matInput [ngModel]="input()" (ngModelChange)="input.set($event)" name="msg" [disabled]="loading()"/>
    </mat-form-field>
    <button mat-stroked-button type="button" (click)="toggleRecording()" [disabled]="loading()" style="margin-right:8px;">
      {{ isRecording ? (lang()==='fr' ? 'ArrÃªter' : 'Stop') : (lang()==='fr' ? 'Parler' : 'Speak') }}
    </button>
    <button mat-raised-button color="primary" type="submit" [disabled]="loading() || !input().trim()">
      {{ lang()==='fr' ? 'Envoyer' : 'Send' }}
    </button>
  </form>
  <div *ngIf="isRecording" style="font-size: 12px; color: #e53935; margin-top: 4px;">
    {{ lang()==='fr' ? 'Enregistrement en coursâ€¦' : 'Recordingâ€¦' }}
  </div>
</div>
